<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Quest - A JavaScript Adventure</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Source+Code+Pro&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden;
        }
        .font-game {
            font-family: 'Press Start 2P', cursive;
        }
        .font-code {
            font-family: 'Source Code Pro', monospace;
        }
        /* Custom scrollbar for webkit browsers */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1f2937;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #4f46e5;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #6366f1;
        }
        .lesson-item.active {
            background-color: #4f46e5;
            color: white;
        }
        #character {
            transition: all 0.5s ease-in-out;
        }
        #code-editor {
            caret-color: #f472b6;
        }
    </style>
</head>
<body class="bg-gray-900 text-white h-screen flex flex-col p-4 gap-4">

    <!-- Header -->
    <header class="text-center">
        <h1 class="font-game text-3xl text-yellow-400 drop-shadow-lg">Code Quest</h1>
        <p class="text-gray-400">Your JavaScript Adventure Begins!</p>
    </header>

    <!-- Main Content: Original Three-Column Layout -->
    <main class="flex-1 grid grid-cols-1 lg:grid-cols-3 gap-4 min-h-0">

        <!-- Left Panel: Lessons & Instructions -->
        <div class="bg-gray-800 rounded-xl shadow-2xl flex flex-col overflow-hidden">
            <h2 class="font-game text-lg p-4 bg-gray-700 text-green-400 border-b-2 border-gray-600">Missions</h2>
            <ul id="lessons-list" class="p-4 space-y-2 overflow-y-auto custom-scrollbar" style="max-height: 40%;">
                <!-- Lessons will be dynamically inserted here -->
            </ul>
            <div class="flex-1 p-4 border-t-2 border-gray-600 bg-gray-800/50 flex flex-col min-h-0 custom-scrollbar overflow-y-auto">
                 <h3 id="instruction-title" class="font-game text-md text-cyan-400 mb-2">Select a Mission!</h3>
                 <div id="instruction-text" class="text-gray-300 mb-4 pr-2 flex-grow">
                    Welcome, Coder! Choose a mission from the list to get started. Your instructions will appear here. Good luck!
                 </div>
                 <h3 class="font-game text-md text-yellow-300 border-t-2 border-gray-700 pt-4 mt-4">Available Commands</h3>
                 <div id="command-list" class="pt-4 space-y-2">
                     <!-- Available commands will be populated here -->
                 </div>
            </div>
        </div>

        <!-- Middle Panel: Game World -->
        <div class="bg-gray-800 rounded-xl shadow-2xl flex flex-col items-center justify-center p-4 relative overflow-hidden">
            <h2 class="font-game text-lg absolute top-4 text-purple-400">Game World</h2>
            <div id="game-world" class="w-full h-full bg-grid-pattern relative border-2 border-gray-600 rounded-lg" style="background-image: linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px); background-size: 40px 40px;">
                <div id="character" class="w-12 h-12 absolute rounded-lg flex items-center justify-center text-2xl" style="left: 50px; top: 50px; background-color: #fbbf24;">
                    ü§ñ
                </div>
                <div id="character-speech" class="absolute hidden bg-white text-black p-2 rounded-lg text-sm" style="transform: translate(-50%, -120%);"></div>
            </div>
        </div>

        <!-- Right Panel: Code Editor & Console -->
        <div class="bg-gray-800 rounded-xl shadow-2xl flex flex-col overflow-hidden">
            <h2 class="font-game text-lg p-4 bg-gray-700 text-red-400 border-b-2 border-gray-600">Code Editor</h2>
            <div class="flex-1 flex flex-col min-h-0">
                <textarea id="code-editor" class="flex-1 bg-gray-900 p-4 text-cyan-300 font-code text-sm w-full h-full resize-none focus:outline-none custom-scrollbar" spellcheck="false">
// Welcome to Code Quest!
// Select a mission from the left panel to get started.
// Your code goes here.
</textarea>
                <button id="run-button" class="w-full py-3 bg-indigo-600 hover:bg-indigo-700 font-game text-lg transition-colors">RUN CODE</button>
            </div>
            <div class="flex flex-col border-t-2 border-gray-600" style="height: 35%;">
                <!-- Debugger -->
                <div class="flex-1 flex flex-col min-h-0">
                    <h3 class="font-game text-sm p-2 bg-gray-700 text-cyan-300">Execution Step</h3>
                    <div id="debugger-output" class="flex-1 bg-black p-2 text-sm font-code overflow-y-auto custom-scrollbar flex items-center justify-center">
                        <span class="text-gray-500">Press RUN to start...</span>
                    </div>
                </div>
                <!-- Console -->
                <div class="flex-1 flex flex-col min-h-0 border-t-2 border-gray-600">
                    <h3 class="font-game text-sm p-2 bg-gray-700 text-yellow-300">Console</h3>
                    <div id="console-output" class="flex-1 bg-black p-2 text-xs font-code overflow-y-auto custom-scrollbar">
                        <span class="text-gray-500">> Console ready...</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // --- DOM ELEMENTS ---
        const lessonsList = document.getElementById('lessons-list');
        const commandList = document.getElementById('command-list');
        const instructionTitle = document.getElementById('instruction-title');
        const instructionText = document.getElementById('instruction-text');
        const gameWorld = document.getElementById('game-world');
        const character = document.getElementById('character');
        const characterSpeech = document.getElementById('character-speech');
        const codeEditor = document.getElementById('code-editor');
        const runButton = document.getElementById('run-button');
        const consoleOutput = document.getElementById('console-output');
        const debuggerOutput = document.getElementById('debugger-output');

        let commandQueue = [];
        let isExecuting = false;

        let characterState = {
            x: 50,
            y: 50,
            color: '#fbbf24',
            emoji: 'ü§ñ'
        };

        // --- GAME CHARACTER FUNCTIONS (API for the kid) ---
        function moveDown(steps = 50) {
            commandQueue.push({ type: 'move', payload: { direction: 'down', steps }, commandString: `moveDown(${steps})` });
        }
        function moveUp(steps = 50) {
            commandQueue.push({ type: 'move', payload: { direction: 'up', steps }, commandString: `moveUp(${steps})` });
        }
        function moveRight(steps = 50) {
            commandQueue.push({ type: 'move', payload: { direction: 'right', steps }, commandString: `moveRight(${steps})` });
        }
        function moveLeft(steps = 50) {
            commandQueue.push({ type: 'move', payload: { direction: 'left', steps }, commandString: `moveLeft(${steps})` });
        }
        function changeColor(newColor) {
            commandQueue.push({ type: 'style', payload: { property: 'color', value: newColor }, commandString: `changeColor('${newColor}')` });
        }
        function changeCharacter(newEmoji) {
            commandQueue.push({ type: 'style', payload: { property: 'emoji', value: newEmoji }, commandString: `changeCharacter('${newEmoji}')` });
        }
        function say(message) {
            const displayMessage = String(message).replace(/'/g, "\\'").replace(/"/g, '\\"');
            commandQueue.push({ type: 'say', payload: { message }, commandString: `say('${displayMessage}')` });
        }

        // --- INTERNAL FUNCTIONS ---
        function updateCharacter() {
            character.style.left = `${characterState.x}px`;
            character.style.top = `${characterState.y}px`;
            character.style.backgroundColor = characterState.color;
            character.innerHTML = characterState.emoji;
        }
        function resetCharacter() {
            logToConsole('Resetting character state...');
            characterState = { x: 50, y: 50, color: '#fbbf24', emoji: 'ü§ñ' };
            updateCharacter();
        }
        function logToConsole(message, type = 'info') {
            const span = document.createElement('span');
            if (type === 'error') {
                span.className = 'text-red-500';
                span.textContent = `> Error: ${message}`;
            } else if (type === 'success') {
                 span.className = 'text-green-400';
                 span.textContent = `> ${message}`;
            } else {
                span.className = 'text-gray-400';
                span.textContent = `> ${message}`;
            }
            consoleOutput.appendChild(document.createElement('br'));
            consoleOutput.appendChild(span);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        async function processQueue() {
            isExecuting = true;
            runButton.disabled = true;
            runButton.textContent = 'EXECUTING...';
            runButton.classList.add('opacity-50', 'cursor-not-allowed');
            for (const command of commandQueue) {
                debuggerOutput.innerHTML = `<span class="text-yellow-400">${command.commandString}</span>`;
                switch (command.type) {
                    case 'move':
                        logToConsole(`Moving ${command.payload.direction} by ${command.payload.steps}px...`);
                        const worldHeight = gameWorld.clientHeight;
                        const worldWidth = gameWorld.clientWidth;
                        switch (command.payload.direction) {
                            case 'down': characterState.y = Math.min(worldHeight - character.offsetHeight, characterState.y + command.payload.steps); break;
                            case 'up': characterState.y = Math.max(0, characterState.y - command.payload.steps); break;
                            case 'right': characterState.x = Math.min(worldWidth - character.offsetWidth, characterState.x + command.payload.steps); break;
                            case 'left': characterState.x = Math.max(0, characterState.x - command.payload.steps); break;
                        }
                        updateCharacter();
                        await new Promise(resolve => setTimeout(resolve, 500));
                        break;
                    case 'style':
                        logToConsole(`Changing ${command.payload.property} to ${command.payload.value}...`);
                        if (command.payload.property === 'color') characterState.color = command.payload.value;
                        if (command.payload.property === 'emoji') characterState.emoji = command.payload.value;
                        updateCharacter();
                        await new Promise(resolve => setTimeout(resolve, 200));
                        break;
                    case 'say':
                        logToConsole(`Character says: ${command.payload.message}`);
                        characterSpeech.innerText = command.payload.message;
                        characterSpeech.style.display = 'block';
                        characterSpeech.style.left = `${characterState.x + character.offsetWidth / 2}px`;
                        characterSpeech.style.top = `${characterState.y}px`;
                        await new Promise(resolve => setTimeout(resolve, 2000));
                        characterSpeech.style.display = 'none';
                        break;
                }
            }
            debuggerOutput.innerHTML = `<span class="text-green-400">Execution Complete!</span>`;
            logToConsole('Code finished successfully!', 'success');
            isExecuting = false;
            runButton.disabled = false;
            runButton.textContent = 'RUN CODE';
            runButton.classList.remove('opacity-50', 'cursor-not-allowed');
        }

        const availableCommands = [
             { name: 'moveRight(steps)', desc: 'Moves right by a number of steps.'},
             { name: 'moveLeft(steps)', desc: 'Moves left.'},
             { name: 'moveUp(steps)', desc: 'Moves up.'},
             { name: 'moveDown(steps)', desc: 'Moves down.'},
             { name: 'changeColor("color")', desc: 'Changes color (e.g., "blue").'},
             { name: 'changeCharacter("emoji")', desc: 'Changes the character icon.'},
             { name: 'say("message")', desc: 'Displays a speech bubble.'},
        ];

        // --- LESSON DATA (EXPANDED) ---
        const lessons = [
            // Module 1: The Basics
            { title: "1. Functions: Giving Commands", explanation: "Think of a function as a single, saved command you can give. In our game, we have built-in commands like <strong>moveRight()</strong> to control the character. You 'call' a function by typing its name followed by parentheses <strong>()</strong>. Every command you give must end with a semicolon <strong>;</strong>.", starterCode: `// Call the moveRight function to give a command.\nmoveRight();` },
            { title: "2. Variables: Storing Info", explanation: "A variable is like a labeled box for storing information. You create one with the keyword <strong>let</strong>, give it a name, and use <strong>=</strong> to put something inside. This is useful for saving data you want to use later, like a favorite color.", starterCode: `// let creates a new variable named 'myColor'.\n// We put the text 'purple' inside it.\nlet myColor = 'purple';\n\n// Now we use the variable's value.\nchangeColor(myColor);` },
            { title: "3. Data Types: Text (Strings)", explanation: "In programming, text is called a 'string'. To make sure the computer knows it's text, you must wrap it in single <strong>' '</strong> or double <strong>\" \"</strong> quotes. Anything inside the quotes is treated as a single piece of text, even if it has spaces or numbers.", starterCode: `// The text inside the quotes is a string.\nsay('Hello, I am a robot!');` },
            { title: "4. Functions with Arguments", explanation: "An 'argument' is extra information you give to a function to change what it does. You put the argument inside the parentheses <strong>()</strong>. For example, <strong>moveRight(100)</strong> tells the move function to go 100 steps instead of the default 50.", starterCode: `// 'green' is the argument for the color.\nchangeColor('green');\n\n// 150 is the argument for the steps.\nmoveRight(150);\nmoveDown(25);` },
            // Module 2: Logic and Loops
            { title: "5. Loops: Repeating Actions", explanation: "A loop tells the computer to repeat a block of code multiple times. A <strong>for</strong> loop is perfect for this. The code <strong>for (let i = 0; i < 4; i++) { ... }</strong> sets up a counter 'i' and runs the code in the curly braces <strong>{ }</strong> as long as 'i' is less than 4.", starterCode: `// This loop will run its code 4 times.\nsay('Here I go!');\nfor (let i = 0; i < 4; i++) {\n  moveRight(50);\n}` },
            { title: "6. Conditionals: Making Choices", explanation: "Conditional logic using <strong>if...else</strong> lets your program make decisions. The code inside the <strong>if { }</strong> block runs only IF the condition in the parentheses is true. If it's false, the code in the <strong>else { }</strong> block runs instead.", starterCode: `let score = 200;\n\n// The 'if' condition checks if score is greater than 100.\nif (score > 100) {\n  changeCharacter('üèÜ');\n  say('I am a winner!');\n} else {\n  say('I need more points!');\n}` },
            { title: "7. Challenge: Draw a Square", explanation: "Let's combine what you've learned! To draw a square, you need to repeat two actions four times: move a certain distance, and then turn. Think about which two movement commands you'd need to use inside a loop that runs 4 times.", starterCode: `// CHALLENGE: Make the character move in a square shape.\nsay("Time to draw!");\n\nfor (let i = 0; i < 4; i++) {\n  // What two commands go here to make a square?\n  moveRight(100);\n  moveDown(100);\n}` },
            // Module 3: Deeper Concepts
            { title: "8. Data Types: Numbers & Math", explanation: "Besides strings, you can also store numbers. You don't need quotes for numbers. You can also do math right inside your code using operators like <strong>+</strong> (add), <strong>-</strong> (subtract), <strong>*</strong> (multiply), and <strong>/</strong> (divide).", starterCode: `// You can do math with numbers.\nlet distance = 25 * 4; // This equals 100\n\nsay('I will move 100 steps.');\nmoveRight(distance);\n\n// You can even do math in the function call!\nmoveDown(50 + 50);` },
            { title: "9. Data Types: Booleans", explanation: "A boolean is the simplest data type: it can only be <strong>true</strong> or <strong>false</strong>. Booleans are the heart of decision-making. An <strong>if</strong> statement always checks if a condition is true or false.", starterCode: `let isFriendly = true;\n\nif (isFriendly) {\n  changeCharacter('üòä');\n  say('Nice to meet you!');\n} else {\n  changeCharacter('üò†');\n  say('Go away!');\n}` },
            { title: "10. Comparison Operators", explanation: "How does an 'if' statement know if something is true? By using comparison operators! <strong>></strong> (greater than), <strong><</strong> (less than), and <strong>===</strong> (equal to) are used to compare two values.", starterCode: `let myLevel = 5;\n\n// This checks if myLevel is exactly equal to 5.\nif (myLevel === 5) {\n  say('Level 5 unlocked!');\n}\n\nmoveRight(100);\n\n// This checks if myLevel is less than 10.\nif (myLevel < 10) {\n  say('I am still a beginner.');\n}` },
            { title: "11. Logical Operators: AND", explanation: "What if you need to check two conditions at once? The AND operator, <strong>&&</strong>, lets you do that. The whole condition is only true if the conditions on BOTH sides of the && are true.", starterCode: `let level = 12;\nlet hasKey = true;\n\n// We need to be level 10+ AND have the key to enter.\nif (level > 10 && hasKey === true) {\n  changeCharacter('üîë');\n  say('The door is open!');\n} else {\n  say('I cannot enter.');\n}` },
            { title: "12. Logical Operators: OR", explanation: "The OR operator, <strong>||</strong>, is the opposite of AND. It checks if at least ONE of the conditions is true. The whole condition is true if the left side is true, OR if the right side is true (or if both are).", starterCode: `let coins = 5;\nlet gems = 2;\n\n// I can afford the item if I have 10 coins OR 3 gems.\nif (coins >= 10 || gems >= 3) {\n  say('I can buy the shield!');\n} else {\n  say('Not enough money!');\n}` },
            // Module 4: Arrays
            { title: "13. Arrays: Making Lists", explanation: "An array is a special variable that can hold a list of items. You create an array using square brackets <strong>[ ]</strong>, and separate each item with a comma. This is great for storing collections of related data.", starterCode: `// An array of strings holding different colors.\nlet rainbowColors = ['red', 'orange', 'yellow', 'green', 'blue'];\n\n// An array of numbers.\nlet movementSteps = [50, 100, 25];\n\nsay('I know my colors!');` },
            { title: "14. Arrays: Accessing Items", explanation: "To get an item from an array, you use its 'index' number. The index is its position in the list, but be careful: **counting starts at 0!** So, the first item is at index <strong>[0]</strong>, the second is at <strong>[1]</strong>, and so on.", starterCode: `let emojiList = ['ü§ñ', 'üöÄ', '‚≠ê', 'üçï'];\n\n// Get the second item (at index 1).\nlet rocket = emojiList[1];\nchangeCharacter(rocket);\n\nsay('To the moon!');` },
            { title: "15. Arrays: The .length Property", explanation: "Every array has a built-in property called <strong>.length</strong> that tells you how many items are inside it. This is incredibly useful, especially when you want a loop to run for every item in an array.", starterCode: `let patrolRoute = [100, 50, 100, 50];\n\nlet numberOfMoves = patrolRoute.length;\n\nsay('My route has ' + numberOfMoves + ' moves.');` },
            { title: "16. Looping Through Arrays", explanation: "Now let's combine loops and arrays! You can use a <strong>for</strong> loop to go through every single item in an array. A common pattern is to make the loop run as long as the counter is less than the array's length.", starterCode: `let colorSequence = ['#ef4444', '#f97316', '#eab308', '#22c55e'];\n\n// This loop will run for every color in the array.\nfor (let i = 0; i < colorSequence.length; i++) {\n  let currentColor = colorSequence[i];\n  changeColor(currentColor);\n  moveRight(60);\n}` },
            { title: "17. Challenge: Rainbow Road", explanation: "Use your knowledge of arrays and loops to make the character move across the screen, changing to each color of the rainbow as it goes. You'll need an array of colors and a for loop!", starterCode: `let rainbow = ['red', 'orange', 'yellow', 'green', 'blue', 'indigo', 'violet'];\n\nsay('Taste the rainbow!');\n\n// CHALLENGE: Write a 'for' loop that goes through the 'rainbow' array.\n// Inside the loop, change the character's color and move it right.` },
            // Module 5: Your Own Functions
            { title: "18. Create Your Own Functions", explanation: "You're not limited to our built-in commands! You can create your own reusable blocks of code using the <strong>function</strong> keyword. This helps organize your code and avoid repetition.", starterCode: `// This defines a new function, but doesn't run it yet.\nfunction jump() {\n  moveUp(50);\n  moveDown(50);\n}\n\n// Now, we can call our new function just like the others!\nsay('Time to jump!');\njump();\nmoveRight(100);\njump();` },
            { title: "19. Functions with Parameters", explanation: "You can make your functions more powerful by letting them accept inputs, just like ours do. These inputs are called 'parameters'. You define them in the parentheses when you create the function.", starterCode: `// 'distance' is a parameter. Its value will be whatever we give it when we call the function.\nfunction moveInSquare(distance) {\n  moveRight(distance);\n  moveDown(distance);\n  moveLeft(distance);\n  moveUp(distance);\n}\n\n// Call the function and give it 100 as the argument for 'distance'.\nmoveInSquare(100);` },
            { title: "20. Challenge: Create a Patrol Bot", explanation: "Create a function called <strong>patrol()</strong> that makes the character move right 100 steps, and then move left 100 steps to return to its start. Then, call this function multiple times inside a loop to make it patrol back and forth.", starterCode: `// CHALLENGE 1: Define a function named patrol().\n// Inside it, move right 100, then move left 100.\n\n\n\n// CHALLENGE 2: Call your patrol() function 3 times using a loop.\nfor (let i = 0; i < 3; i++) {\n  // call patrol here\n}` },
            // Module 6: Objects
            { title: "21. Objects: Grouping Variables", explanation: "An object is a container for related variables (called 'properties'). You create one with curly braces <strong>{ }</strong>. It lets you group all the data about one 'thing' into a single, organized structure.", starterCode: `// This object describes a player.\nlet player = {\n  name: 'Sparky',\n  level: 5,\n  color: 'orange'\n};\n\n// Let's use the data from our object.\nsay('My name is ' + player.name);\nchangeColor(player.color);` },
            { title: "22. Accessing Object Properties", explanation: "You can access the data inside an object using dot notation. Simply type the object's variable name, a dot <strong>.</strong>, and the name of the property you want to get.", starterCode: `let enemy = {\n  type: 'Slime',\n  health: 100,\n  emoji: 'üü¢'\n};\n\nchangeCharacter(enemy.emoji);\nsay('A ' + enemy.type + ' appears!');` },
            { title: "23. Modifying Object Properties", explanation: "You can change the values inside an object using dot notation and the assignment operator <strong>=</strong>. This is useful for updating the state of something, like a character's position or health.", starterCode: `let treasureChest = {\n  isOpen: false,\n  emoji: 'üì¶'\n};\n\n// At first, the chest is closed.\nchangeCharacter(treasureChest.emoji);\nsay('A closed chest!');\nmoveRight(100);\n\n// Now, let's open it!\ntreasureChest.isOpen = true;\ntreasureChest.emoji = 'üíé';\n\nchangeCharacter(treasureChest.emoji);\nsay('I found a diamond!');` },
            { title: "24. Arrays of Objects", explanation: "This is powerful! You can create a list where each item in the list is a complex object. This is how you would store data for multiple enemies, players, or items in a real game.", starterCode: `let enemies = [\n  { name: 'Slime', x: 100, emoji: 'üü¢'},\n  { name: 'Ghost', x: 200, emoji: 'üëª'},\n  { name: 'Bat', x: 300, emoji: 'ü¶á'}\n];\n\n// Let's greet the second enemy.\nsay('Hello, ' + enemies[1].name);\nchangeCharacter(enemies[1].emoji);` },
            { title: "25. Challenge: Spawn Enemies", explanation: "You have an array of enemy objects. Write a <strong>for loop</strong> to go through the array. Inside the loop, read each enemy's data and use it to move the character and change its appearance, then say the enemy's name.", starterCode: `let enemyList = [\n  { name: 'Goblin', color: 'green', emoji: 'üë∫'},\n  { name: 'Skeleton', color: 'white', emoji: 'üíÄ'},\n  { name: 'Zombie', color: 'darkgreen', emoji: 'üßü'}\n];\n\n// CHALLENGE: Loop through enemyList.\n// Inside, use the color, emoji, and name from each object.\nfor (let i = 0; i < enemyList.length; i++) {\n  let currentEnemy = enemyList[i];\n  // Add commands here!\n  moveRight(100);\n}` },
            // Module 7: Final Projects
            { title: "26. Final Challenge: The Maze", explanation: "This is a big one! Use all your skills‚Äîvariables, loops, conditionals, and functions‚Äîto navigate a simple path. The goal is to get the character from the start to the finish by following a specific sequence of moves.", starterCode: `// The path is: Right 100, Down 200, Right 200, Up 100.\n\nsay('Time to solve the maze!');\n\n// Can you write the code to get to the end?\n` },
            { title: "27. Sandbox Mode", explanation: "Congratulations! You've learned the fundamentals of programming. Now it's your turn to be creative. Use this sandbox to build whatever you want. Try making new shapes, creating a dance, or telling a story. The only limit is your imagination!", starterCode: `// Sandbox Mode! Go wild!\nsay('I can code anything!');\n\n` }
        ];
        
        // --- EVENT LISTENERS & INITIALIZATION ---
        function selectLesson(index) {
            const lesson = lessons[index];
            instructionTitle.textContent = lesson.title;
            instructionText.innerHTML = lesson.explanation;
            codeEditor.value = lesson.starterCode;
            
            document.querySelectorAll('.lesson-item').forEach((item, idx) => {
                item.classList.toggle('active', idx === index);
            });

            logToConsole(`Mission selected: ${lesson.title}`, 'success');
            resetCharacter();
        }

        runButton.addEventListener('click', () => {
            if (isExecuting) return; 

            commandQueue = [];
            consoleOutput.innerHTML = '';
            logToConsole('Parsing code...');
            debuggerOutput.innerHTML = '<span class="text-gray-500">Parsing...</span>';
            resetCharacter();

            const userCode = codeEditor.value;
            
            try {
                const populateQueue = new Function(userCode);
                populateQueue();
                logToConsole('Code parsed successfully. Starting execution...', 'success');
                processQueue();
            } catch (error) {
                logToConsole(error.message, 'error');
                debuggerOutput.innerHTML = `<span class="text-red-500">Error! Check console.</span>`;
            }
        });

        window.addEventListener('load', () => {
            // Populate lessons
            lessons.forEach((lesson, index) => {
                const li = document.createElement('li');
                li.className = 'lesson-item p-3 bg-gray-700 rounded-lg cursor-pointer hover:bg-indigo-500 transition-colors text-sm';
                li.textContent = lesson.title;
                li.addEventListener('click', () => selectLesson(index));
                lessonsList.appendChild(li);
            });

            // Populate command list
            availableCommands.forEach(cmd => {
                const div = document.createElement('div');
                div.className = 'text-sm';
                div.innerHTML = `<p class="font-code text-pink-400">${cmd.name}</p><p class="text-xs text-gray-400 pl-2">${cmd.desc}</p>`;
                commandList.appendChild(div);
            });

            updateCharacter();
        });
    </script>
</body>
</html>

